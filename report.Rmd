---
title: "Report"
author: ""
date: ""
output: 
  html_document:
    toc: true
    toc_float: true
    theme: cerulean
    code_folding: hide
---
# Group members: Shayne Estill(ske2118), Woojin Shin(ws2721), Naomi Simon-Kumar(ns3782), Serena Ting(sjt2164)

# Motivation

Children’s health and development is impacted by the surrounding environment, particularly in dense urban environments like New York City (NYC). Poor air quality due to urban air pollution can influence and have long-term consequences for child and adolescent respiratory health. The challenges of urban environmental health are further complicated by climate change, particularly through the urban heat island effect, which can increase the risk of heat-related illnesses (Heaviside et al., 2017). Limited research shows that elevated temperatures due to the urban heat island effect are associated with increased emergency department (ED) visits among children (Sheffield et al., 2018). 

These health outcomes may be influenced by the availability of green spaces, which can help filter air pollutants and provide cooler areas for shelter from heat. Importantly, environmental health risks disproportionately affect children from low-income neighborhoods and communities of color, where there is often limited access to green spaces and higher exposure to environmental stressors (Corburn et al., 2006).

Through this project, we aim to investigate how these interconnected environmental determinants- air quality, green space availability, and urban heat patterns - vary across NYC boroughs and their potential associations with children’s health, specifically focusing on ED asthma admissions and hospitalizations. We believe that understanding these relationships is crucial for informing urban planning policies and public health initiatives aimed at improving children’s health in New York City.

# Initial Questions

#### 1. How do pediatric asthma outcomes and environmental factors vary across NYC?

* How do asthma ED admission and hospitalization rates vary across NYC boroughs between 2016-2018 and 2019-2021?
* What is the distribution of environmental factors (PM2.5, temperature, greenspace) across NYC during these periods?

#### 2. What relationships emerge between environmental factors and pediatric asthma rates across NYC?

* Do areas with higher ED admission and hospitalization rates align with particular environmental patterns?
* Are there geographic clusters where both environmental inequities and higher asthma rates persist across time periods?
* What are the estimated associations between environmental factors (PM2.5, temperature, greenspace) and pediatric asthma ED rates, accounting for borough-level and temporal variation?

# Data

```{r setup, include=FALSE}

# Set global knit options

knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE
)

```

```{r}

# Load libraries 

library(tidyverse)
library(sf)
library(ggplot2)
library(readxl)

```

The research project integrated multiple datasets to examine the relationship between pediatric asthma outcomes and environmental factors across New York City. Data was sourced from various public health and environmental databases, with each dataset requiring specific cleaning and standardization before merging.

#### Data Sources

The analysis incorporated five primary datasets from different sources. Pediatric ED admissions and hospitalizations data for the 2016-2021 periods were obtained from the New York State Asthma Dashboard, providing emergency department visit rates and hospitalization rates for children aged 0-17 years at both ZIP code and borough levels. Air quality data, specifically PM2.5 measures, were obtained from a NYC Kaggle dataset, providing relevant data at both borough and Community District levels. 

Greenspace data through 2021 was sourced from the NYC Open Data portal, providing park properties and greenspace measurements at the borough level. Temperature data for 2016-2021 was extracted from the Open-Meteo historical weather API, including daily temperature measurements for each borough. The Heat Vulnerability Index data came from NYC Heat Vulnerability Index Rankings, corresponding with vulnerability measures at the ZIP code level.

#### Data Cleaning Procedures

**Pediatric Asthma Data**

The pediatric asthma data cleaning process began with standardizing variable names using the janitor package. The data was filtered to focus on two key health indicators: emergency department visit rates and hospitalization rates. Missing values required special handling, with suppressed data (marked as "s") and unstable estimates (marked with "*") converted to NA. Borough names were standardized for consistency across datasets, including converting "Kings" to "Brooklyn". Separate datasets were created for the 2016-2018 and 2019-2021 time periods.

**PM2.5 Data**

The PM2.5 data cleaning resulted in several datasets for different analytical purposes. The first dataset calculated borough-level averages for the two time periods of interest. A second dataset maintained community district-level data for visualization purposes. A third dataset preserved UHF42-level data specifically for to analyze asthma outcomes. Throughout the cleaning process, geographic identifiers were standardized, and period averages were calculated for 2016-2018 and 2019-2021.

**Greenspace Data**

For the greenspace data, borough abbreviations were first recoded to full names for consistency and variables were converted to appropriate types. The acquisition dates were separated into component parts for temporal analysis. The data was then aggregated to calculate total greenspace acreage by borough for each time period. The final dataset included only properties acquired before 2022 to be consistent with the time periods of interest.

**Temperature Data**

Temperature data processing began with separate extractions for each borough. Date formats were standardized across all borough datasets. Average temperatures were calculated by borough and time period to match the temporal structure of other datasets. The individual borough datasets were then combined into a unified temperature dataset that maintained consistency with the project's overall geographic and temporal framework.

**Heat Vulnerability Index**

The Heat Vulnerability Index data required minimal cleaning, focusing on standardizing ZIP code formats and converting the vulnerability index to a factor variable. The final cleaned dataset retained only the essential variables needed for analysis: ZIP code and heat vulnerability classification.

#### Data Merging Strategy

The creation of the final merged dataset followed a careful sequential process to maintain data integrity. The foundation was built by combining the 2016-2018 and 2019-2021 pediatric admissions data. Temperature data was then merged using borough and time period as keys, followed by PM2.5 data using the same keys. Greenspace measurements were incorporated next, again matching on borough and time period. The Heat Vulnerability Index was the final addition, merged using ZIP code as the key.

Variable types were subsequently standardized, with categorical variables converted to factors and rates maintained as numeric values. Incomplete and missing records were removed to ensure data quality. Separate datasets were created for emergency department visits and hospitalizations for focused analysis on different pediatric asthma outcomes. Borough-level average rates were calculated to enable analysis at multiple geographic scales.

#### Final Dataset Structure

The resulting merged dataset, saved as "NYC_total.csv", represents a comprehensive integration of health outcomes, environmental measures, and heat vulnerability. It includes emergency department visits and hospitalization rates, PM2.5 levels, temperature measurements, heat vulnerability, and greenspace acreage. Geographic identifiers at both ZIP code and borough levels enable spatial analysis, while time period indicators allow for temporal comparisons. Borough-level averages provide geographic information relevant to the planned analysis.

This final dataset is sufficient for addressing our research aims specific to analyzing pediatric asthma outcomes in relation to environmental factors and heat vulnerability across New York City's boroughs and ZIP codes for the periods 2016-2018 and 2019-2021.


# Exploratory Analysis

Our exploratory analysis examined relevant environmental and health variables for pediatric asthma across New York City's five boroughs between 2016-2018 and 2019-2021. We explored two health indicators: pediatric asthma emergency department (ED) visits and pediatric asthma hospitalizations. We further examined three environmental factors of interest to our research aims, specifically distributions of fine particulate matter (PM2.5), greenspace, and temperature patterns across New York City.

## Asthma-Related Healthcare Utilization
### Emergency Department (ED) Visits

```{r}

# Load ED data for 2016-2018

ed_2016_2018 = 
  read_csv("data/ed_2016_2018.csv")

# Load ED data for 2019-2021

ed_2019_2021 = 
  read_csv("data/ed_2019_2021.csv")

# Combine datasets

all_data <- bind_rows(
  ed_2016_2018 %>% mutate(period = "2016-2018"),
  ed_2019_2021 %>% mutate(period = "2019-2021")
)

# Create borough averages for both indicators

borough_data <- all_data %>%
  group_by(borough, period, indicator) %>%
  summarize(avg_rate = mean(zip_code_rate, na.rm = TRUE))

# Create simple borough-level summaries

borough_summary <- all_data %>%
  group_by(borough, period, indicator) %>%
  summarize(
    avg_rate = round(mean(zip_code_rate, na.rm = TRUE), 1),
    .groups = "drop"  
  )

# Table for ED visits 

ed_summary <- borough_summary %>%
  filter(indicator == "ed_visits_rate") %>%
  pivot_wider(
    names_from = period,
    values_from = avg_rate
  ) %>%
  mutate(
    percent_change = round(((`2019-2021` - `2016-2018`) / `2016-2018` * 100), 1)
  ) %>%
  arrange(desc(`2016-2018`))

# Print ED Visits Summary

ed_summary %>%
  select(-indicator) %>%
  knitr::kable(
    col.names = c("Borough", "2016-2018", "2019-2021", "% Change")
  )

```

**Table 1. Borough Average Asthma ED Visit Rates per 10,000 Children (aged 0-17 Years)**

```{r}

# Load NYC zipcode shapefile

nyc_zip_sf <- st_read("shapefiles/geo_export_8df5c38c-c74c-4840-9d00-da16c0201e07.shp", quiet = TRUE)

# Create the map_data

borough_data <- borough_data %>%
  rename(boro_name = borough)

map_data <- nyc_zip_sf %>%
  left_join(borough_data, by = "boro_name")

# Create ED Visits Map 

ed_plot <- ggplot() +
  geom_sf(data = filter(map_data, indicator == "ed_visits_rate"), 
          aes(fill = avg_rate)) +
  facet_wrap(~period) +
  scale_fill_viridis_c(
    option = "plasma"
  ) +
  theme_minimal() +
  labs(title = "Pediatric Asthma ED Visit Rates by NYC Borough") +
  theme(
    plot.title = element_text(size = 12),
    legend.position = "right",
    legend.key.height = unit(2, "cm"),
    axis.text = element_blank(),      
    axis.ticks = element_blank(),     
    panel.grid = element_blank()      
  )

# Display plot

ed_plot

```

**Figure 1. Borough Average ED Visit Rates per 10,000 Children (aged 0-17 Years)**

Analysis of ED visit rates showed significant disparities dependent on borough and time period. The Bronx, the northernmost borough of NYC, consistently showed the highest rates across both periods, with 347.7 and 180.7 visits per 10,000 children respectively. All boroughs experienced substantial decreases between 2016-2018 and 2019-2021, with reductions ranging from 43% to 48%. 

Despite this overall decline, the Bronx's 2019-2021 rate remained higher than any other borough's 2016-2018 rates. Geographic visualization highlighted persistent health disparities between boroughs, with the Bronx showing consistently higher visit rates compared to other areas of the city, including Manhattan to its south, Queens to the east, and the more distant southern boroughs of Brooklyn and Staten Island.

The most striking change between the two periods is the apparent reduction in ED visits during 2019-2021, which could potentially be related to the COVID-19 pandemic's impact on healthcare utilization patterns.

### Hospitalizations

```{r, echo=FALSE}

# Table for asthma hospitalizations

hosp_summary <- borough_summary %>%
  filter(indicator == "hosp_rate") %>%
  pivot_wider(
    names_from = period,
    values_from = avg_rate
  ) %>%
  mutate(
    percent_change = round(((`2019-2021` - `2016-2018`) / `2016-2018` * 100), 1)
  ) %>%
  arrange(desc(`2016-2018`))

# Print Hospitalization Summary

hosp_summary %>%
  select(-indicator) %>%
  knitr::kable(
    col.names = c("Borough", "2016-2018", "2019-2021", "% Change")
  )

```

**Table 2. Borough Average Asthma Hospitalizations per 10,000 Children (aged 0-17 Years)**

Hospitalization patterns largely reflected ED visit trends. The Bronx again led with the highest rates at 58.5 and 36.8 per 10,000 children across the two periods. All boroughs showed considerable decreases between periods, ranging from 32% to 40%. Queens and Staten Island had the lowest hospitalization rates throughout both time periods. 

Notably, the ratio between ED visits and hospitalizations (approximately 6:1) suggests that while many children visit the ED for asthma, a smaller proportion require hospitalization.


```{r}

# Create Hospitalizations Map 

hosp_plot <- ggplot() +
  geom_sf(data = filter(map_data, indicator == "hosp_rate"), 
          aes(fill = avg_rate)) +
  facet_wrap(~period) +
  scale_fill_viridis_c(
    option = "plasma"
  ) +
  theme_minimal() +
  labs(title = "Pediatric Asthma Hospitalization Rates by NYC Borough") +
  theme(
    plot.title = element_text(size = 12),
    panel.grid = element_blank(),         
    axis.text = element_blank(),           
    axis.ticks = element_blank(),         
    axis.title = element_blank()         
  )

# Display plot

hosp_plot

```

**Figure 2. Borough Average Asthma Hospitalization Rates per 10,000 Children (aged 0-17 Years)**

Figures 1 and 2 reveal persistent borough-level disparities in both ED visits and hospitalizations, with higher rates of healthcare utilization in the Bronx reflecting an unequal distribution of child asthma burden in New York City. These patterns suggest underlying socioeconomic and environmental factors affecting child asthma rates across different boroughs, with communities from lower-resourced parts of New York City bearing a disproportionate share of the health burden.


## Environmental Determinants
### Air Quality Patterns (PM2.5)


```{r}

# Load PM data

particulate_matter = 
  read_csv("data/Air_Quality_20231208.csv")

# Produce tidied PM dataset for analysis

tidy_analysis_pm = 
  particulate_matter |>
  janitor::clean_names() |>
    mutate(
    unique_id = as.character(unique_id),
    indicator_id = as.character(indicator_id),
    geo_join_id = as.character(geo_join_id)) |>
  filter(name == "Fine particles (PM 2.5)") |>
  filter(time_period %in% c("Annual Average 2016", "Annual Average 2017",
                            "Annual Average 2018", "Annual Average 2019",
                            "Annual Average 2020", "Annual Average 2021")) |>
  filter(geo_type_name == "Borough") |>
  select(-unique_id, -indicator_id, -start_date) |>
    rename(borough = geo_place_name) |>
  mutate(
    period = case_when(
      time_period %in% c("Annual Average 2016", "Annual Average 2017", "Annual Average 2018") ~ "2016-2018",
      time_period %in% c("Annual Average 2019", "Annual Average 2020", "Annual Average 2021") ~ "2019-2021"
    )
  ) |>
  group_by(borough, period) |>
  summarize(
    average_pm2.5 = mean(data_value, na.rm = TRUE),
    .groups = "drop"
  ) |>
  pivot_wider(
    names_from = period,
    values_from = average_pm2.5,
    names_prefix = "avg_pm2.5_"
  )

```

```{r}

# Plot of average PM2.5 levels by borough between 2016-2018 and 2019-2021

tidy_analysis_pm |>
  pivot_longer(cols = -borough, names_to = "Year_Group", values_to = "PM2.5") |> 
  mutate(borough = factor(borough, levels = unique(borough[order(PM2.5)]))) |> 
  ggplot(aes(x = borough, y = PM2.5, fill = Year_Group)) +
  geom_bar(position = "dodge", stat = "identity") +
   labs(
    title = "Average PM2.5 Levels by Borough (2016-2018 vs 2019-2021)",
    x = "Borough",
    y = "PM2.5 Values",
    fill = "Year Group"
  ) 

```

**Figure 3. Average PM.25 levels across boroughs: 2016-2018 vs 2019-2021**

```{r}

# Print PM2.5 Summary

tidy_analysis_pm_diff <- 
  tidy_analysis_pm |>
  mutate(
    `avg_pm2.5_2016-2018` = round(`avg_pm2.5_2016-2018`, 3),
    `avg_pm2.5_2019-2021` = round(`avg_pm2.5_2019-2021`, 3),
    pm2.5_difference = round(`avg_pm2.5_2016-2018` - `avg_pm2.5_2019-2021`, 3)
  )

knitr::kable(tidy_analysis_pm_diff, col.names = c("Borough", "Average PM2.5 (2016-2018)", "Average PM2.5 (2019-2021)", "Difference in PM2.5 Levels"))

```

**Table 3. Borough Average ED Visit Rates per 10,000 Children (aged 0-17 Years)**

Fine particulate matter (PM2.5) concentrations show distinct spatial patterns that partially align with asthma outcomes. Manhattan, despite not having the highest asthma rates, consistently recorded the highest PM2.5 concentrations (8.72 μg/m³ in 2016-2018, decreasing to 7.63 μg/m³ in 2019-2021). This interesting divergence from reported asthma ED visit and hospitalization rates suggests that while air quality is a significant factor, other environmental and social determinants influence pediatric asthma outcomes in New York City.


```{r}

# Load NYC geospatial data

geography = 
  read_excel("data/geoid_borough_name_nyc.xlsx") |>
  rename(geo_join_id = ID) |>
  mutate(geo_join_id = 
           as.character(geo_join_id))

# Tidy dataset for geospatial PM analysis

tidy_uhf42_pm = 
  particulate_matter |>
  janitor::clean_names() |>
    mutate(
    unique_id = as.character(unique_id),
    indicator_id = as.character(indicator_id),
    geo_join_id = as.character(geo_join_id)) |>
  filter(name == "Fine particles (PM 2.5)") |>
  filter(time_period %in% c("Annual Average 2016", "Annual Average 2017",
                            "Annual Average 2018", "Annual Average 2019",
                            "Annual Average 2020", "Annual Average 2021")) |>
  filter(geo_type_name == "UHF42") |>
  select(-unique_id, -indicator_id, -start_date) |>
  mutate(
    period = case_when(
      time_period %in% c("Annual Average 2016", "Annual Average 2017", "Annual Average 2018") ~ "2016_2018",
      time_period %in% c("Annual Average 2019", "Annual Average 2020", "Annual Average 2021") ~ "2019_2021"
    )
  ) |>
  group_by(geo_place_name, geo_join_id, period) |>
  summarize(
    average_pm2.5 = mean(data_value, na.rm = TRUE),
    .groups = "drop"
  ) |>
  pivot_wider(
    names_from = period,
    values_from = average_pm2.5,
    names_prefix = "avg_pm2.5_"
  ) 

# Load shapefiles map for UHF data

uhf42_map <- st_read("data/UHF_42_DOHMH_2009.shp", quiet = TRUE) 

tidy_uhf42_pm <- 
  tidy_uhf42_pm |>
  rename(UHFCODE = geo_join_id) |>
  mutate(
    UHFCODE = as.double(UHFCODE))

# Combine geospatial data and PM data

map_uhf42 <- 
  uhf42_map |>
  left_join(tidy_uhf42_pm, by = "UHFCODE") |>
  pivot_longer(cols = starts_with("avg_pm2.5_"), 
               names_to = "time_period", 
               values_to = "avg_pm2.5")

# Produce heat map 

heat_map_pm2.5 <- ggplot() +
  geom_sf(data = map_uhf42, aes(fill = avg_pm2.5)) +
  facet_wrap(~time_period, ncol = 2) +
  scale_fill_viridis_c(option = "plasma", na.value = "grey50") +
  labs(
    title = "PM2.5 (ug/m3) Levels by UHF42 Neighborhood",
    fill = "PM2.5"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 12),
    legend.position = "right",
    legend.key.height = unit(2, "cm"),
    panel.grid = element_blank(),          
    axis.text = element_blank(),           
    axis.ticks = element_blank(),         
    axis.title = element_blank()          
  )

# Show heat map for PM2.5 

heat_map_pm2.5

```

**Figure 4. PM2.5 levels by United Hospital Fund (UHF) Neighborhoods**

The uniform reduction in PM2.5 levels across boroughs between the two periods (particularly the identical 1.02 μg/m³ reduction in both the Bronx and Brooklyn) suggests city-wide factors, possibly including urban policy interventions or COVID-19-related activity reductions, affected air quality improvements. Based on UHF42 neighborhood-level analysis, Midtown Manhattan has consistently high PM2.5 levels across both time periods. The PM2.5 hotspots in Midtown Manhattan suggest urban factors, such as traffic patterns, industrial activities and building density, likely play a key role in determining local air quality.

### Greenspace

```{r}

# Load greenspace data

greenspace_clean = read_csv("./data/Parks_Properties_20241126.csv", na = c("NA", ".", "")) |>
  janitor::clean_names() |> 
  mutate(
    borough = case_match(borough, #renamed borough according to data dictionary
      "R" ~ "Staten Island",
      "Q" ~ "Queens",
      "X" ~ "Bronx",
      "B" ~ "Brooklyn",
      "M" ~ "Manhattan"),
    typecategory = as.factor(typecategory), #converted char variables into factors
    borough = as.factor(borough)) |>
  separate(acquisitiondate, into = c("year", "month", "day"), sep = "-") |>
  select(year, borough, acres, typecategory) |> 
  filter(year < 2022 | is.na(year))

```


```{r}

# Load 2016-2018 dataset

dataset1_gs = greenspace_clean |>
  filter(year < 2019 | is.na(year)) |> 
  group_by(year, borough) |>
  summarise(avg_acres_per_yr_bor = mean(acres, na.rm = TRUE), .groups = "drop")

dataset1_gs_calc = dataset1_gs |> 
  group_by(borough) |> 
  summarise(acres_sum = sum(avg_acres_per_yr_bor, na.rm = TRUE), .groups = "drop") |> 
  mutate(year_group = "2016-2018")

# Load 2019-2021 dataset

dataset2_gs = greenspace_clean |>
  filter(year < 2022 | is.na(year)) |>
  group_by(year, borough) |>
  summarise(avg_acres_per_yr_bor = mean(acres, na.rm = TRUE), .groups = "drop")

dataset2_gs_calc = dataset2_gs |> 
  group_by(borough) |> 
  summarise(acres_sum = sum(avg_acres_per_yr_bor, na.rm = TRUE), .groups = "drop") |> 
  mutate(year_group = "2019-2021")

# Combine datasets

total_acres = bind_rows(dataset1_gs_calc, dataset2_gs_calc)
  
# Total acres dataset

Greenspace_data = total_acres |>
  pivot_wider(names_from = year_group,
              values_from = acres_sum)

# Produce plot of greenspace distribution across NYC boroughs

ggplot(total_acres, aes(x = reorder(borough, acres_sum), y = acres_sum, fill = year_group)) + 
  geom_bar(stat = "identity", position = "dodge", alpha = 0.7) + 
  labs(x = "Borough", y = "Greenspace (Total Acres)", title = "Greenspaces Across Borough by Year Group") +
  theme_minimal()

```

**Figure 5. Greenspace distribution across boroughs: 2016-2018 vs 2019-2021**

```{r, echo=FALSE}

# Table of changes in greenspace

Greenspace_data |>
  mutate(
    Difference = round(`2019-2021` - `2016-2018`, 3)) |>
  arrange(desc(Difference)) |>
  knitr::kable(col.names = c("Borough", "2016-2018", "2019-2021", "Difference"))

```

**Table 4. Difference in Greenspace distribution across boroughs**

Our analysis highlights substantial inequities in greenspace access across New York City. Staten Island's dominance in both total coverage (approximately 3,000 acres) and increased greenspace (258.72 acres) stands in contrast to the Bronx, which showed the lowest coverage despite a modest increase of 119.625 acres. This apparent inverse relationship between greenspace availability and asthma rates - with the Bronx having the highest asthma ED visit and hospitalization rates and lowest greenspace coverage - suggests a potential environmental health relationship warranting further investigation.


```{r}

# Calculate mean acres for each type category across all years

types_nyc = greenspace_clean |>
  select(-borough) |>
  group_by(typecategory) |>
  summarise(acres_tp = mean(acres, na.rm = TRUE), .groups = "drop")

# Process data for 2016-2018 period

type1A = greenspace_clean |>
  filter(year < 2019 | is.na(year)) |> 
  group_by(year, borough, typecategory) |>
  summarise(avg_acres_per_yr_bor = mean(acres, na.rm = TRUE), .groups = "drop")

# Calculate total acres by borough and type for 2016-2018

type1B = type1A |> 
  group_by(borough, typecategory) |> 
  summarise(acres_sum = sum(avg_acres_per_yr_bor, na.rm = TRUE), .groups = "drop") |> 
  mutate(year_group = "year1") #2016-2018

# Process data for 2019-2021 period

type2A = greenspace_clean |>
  filter(year < 2022 | is.na(year)) |>
  group_by(year, borough, typecategory) |>
  summarise(avg_acres_per_yr_bor = mean(acres, na.rm = TRUE), .groups = "drop")

# Calculate total acres by borough and type for 2019-2021

type2B = type2A |> 
  group_by(borough, typecategory) |> 
  summarise(acres_sum = sum(avg_acres_per_yr_bor, na.rm = TRUE), .groups = "drop") |> 
  mutate(year_group = "year2") #2019-2021

# Combine both time periods and calculate total acres by type

binded = bind_rows(type1B, type2B) |>
  group_by(typecategory, year_group) |>
  summarise(acres_total = sum(acres_sum, na.rm = TRUE))

# Create bar plot comparing greenspace types between periods

binded |> 
   mutate(year_group = case_match(year_group,
      "year1" ~ "2016-2018",
      "year2" ~ "2019-2021")) |>
  ggplot(aes(x = reorder(typecategory, acres_total), y = acres_total, fill = year_group)) + 
  geom_bar(stat = "identity", position = "dodge", width = 0.6) +
  labs(x = "Greenspace Types", y = "Total Acres", title = "Total Acres of NYC Greenspace by Type and Year Group") +
    theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))

```

**Figure 6. Greenspace types across boroughs: 2016-2018 vs 2019-2021**

```{r, echo=FALSE}

# Create table showing change in acres between time periods

Total_acres_table_test = binded |>
 pivot_wider(names_from = year_group,
             values_from = acres_total) |>
 mutate(across(where(is.numeric), ~round(., 3)),
        diff = round(year2 - year1, 3))

# Filter for only positive changes and sort by largest increase 

table_type = Total_acres_table_test |>
 filter(diff > 0) |>
 arrange(desc(diff))

# Produce table with greenspace types between years

knitr::kable(table_type, col.names = c("Greenspace Type", "2016-2018", "2019-2021", "Difference"))

```

**Table 5. Difference in greenspace coverage across boroughs: 2016-2018 vs 2019-2021**

The analysis of greenspace types suggests varying priorities in green developments across New York City. The substantial expansion of neighborhood parks (259.617 acres) and managed sites (119.095 acres) indicates focused efforts to increase accessible green spaces. However, the minimal changes in smaller categories like gardens and plazas suggests that large-scale greenspace development may not adequately address neighborhood-level access needs, which could be more meaningful for boroughs like the Bronx.

```{r, echo=FALSE, message = FALSE}

# Create initial dataset of acres by type, borough, and year group

perBor = bind_rows(type1B, type2B) |>
  group_by(typecategory, year_group, borough) |>
  summarise(acres_total = sum(acres_sum, na.rm = TRUE)) 

# Process data for each borough separately
# For each:
# 1. Filter for specific borough
# 2. Round acreage to 2 decimal places
# 3. Reshape data to wide format with years as columns
# 4. Sort by year1 values in descending order
# 5. Filter to keep only the largest spaces (threshold varies by borough)

Bronx_perBor = perBor |> 
  filter(borough == "Bronx") |>
  mutate(acres_total = round(acres_total, 2)) |>
  pivot_wider(
    names_from = year_group,
    values_from = acres_total) |>
  arrange(desc(year1)) |>
  filter(year1 > 200) 

Brook_perBor = perBor |> 
  filter(borough == "Brooklyn") |>
  mutate(acres_total = round(acres_total, 2)) |>
  pivot_wider(
    names_from = year_group,
    values_from = acres_total) |>
  arrange(desc(year1)) |>
  filter(year1 > 500) 

Man_perBor = perBor |> 
  filter(borough == "Manhattan") |>
  mutate(acres_total = round(acres_total, 2)) |>
  pivot_wider(
    names_from = year_group,
    values_from = acres_total) |>
  arrange(desc(year1)) |>
  filter(year1 > 200) 

Q_perBor = perBor |> 
  filter(borough == "Queens") |>
  mutate(acres_total = round(acres_total, 2)) |>
  pivot_wider(
    names_from = year_group,
    values_from = acres_total) |>
  arrange(desc(year1)) |>
  filter(year1 > 900) 

SI_perBor = perBor |> 
  filter(borough == "Staten Island") |>
  mutate(acres_total = round(acres_total, 2)) |>
  pivot_wider(
    names_from = year_group,
    values_from = acres_total) |>
  arrange(desc(year1)) |>
  filter(year1 > 760)

# Combine all borough data and format for final table

top3_bor_gstype = bind_rows(Bronx_perBor, Brook_perBor, Q_perBor, Man_perBor, SI_perBor) |>
  select(borough, typecategory, year1, year2) |>
  rename(acres = year1) |>
  select(-year2) |>
  group_by(borough) |>
  mutate(rank = rank(-acres)) |>
  ungroup() |>
  mutate(
    rank = case_match(rank,
      1 ~ "First",
      2 ~ "Second",
      3 ~ "Third"),
    typecategory = paste(typecategory, " (", acres, ")", sep = "")) |>
    select(-acres) |>
  pivot_wider(
    names_from = rank,
    values_from = typecategory) 

# Create formatted table with clear column names

knitr::kable(top3_bor_gstype, col.names = c("Borough", "Highest", "Second Highest", "Third Highest"))
 
```

**Table 6. Top 3 Greenspace Types (Total Acres) Across Boroughs**

While the Bronx contains major Flagship Parks and Parkways among its largest green spaces, these types of spaces may not provide the same respiratory health benefits as smaller, more accessible neighborhood parks distributed throughout residential areas where children live and play. Despite the expansion of neighborhood parks (259.617 acres) and managed sites (119.095 acres) across the city, the concentration of greenspace in large, potentially less accessible formats like Flagship Parks may limit their protective effects against childhood asthma. Staten Island's lower asthma rates and large Nature Area (1690.97 acres) present an interesting contrast, though this association may reflect broader factors such as lower population density or better air quality rather than the specific type of greenspace.

### Temperature

```{r}

# Load and clean raw temperature data for each borough

manhattan = read_csv("data/manhattan.csv",skip = 3) |>
  mutate(Borough = "Manhattan") |> 
  janitor::clean_names()

bronx = read_csv("data/bronx.csv",skip = 3) |>
  mutate(Borough = "Bronx") |> 
  janitor::clean_names()

brooklyn = read_csv("data/brooklyn.csv",skip = 3) |>
  mutate(Borough = "Brooklyn") |> 
  janitor::clean_names()

queens = read_csv("data/queens.csv",skip = 3) |>
  mutate(Borough = "Queens") |> 
  janitor::clean_names()

staten_island = read_csv("data/staten_island.csv",skip = 3) |>
  mutate(Borough = "Staten Island") |> 
  janitor::clean_names()

# Combine temperature data from all boroughs and format dates/times

all_temp = bind_rows(manhattan, bronx, brooklyn, queens, staten_island) |> 
  mutate(borough = as.factor(borough)) |> 
  mutate(date = as.Date(time, format = "%d/%m/%Y")) |> 
  select(time:temperature_2m_mean, borough, date) |> 
  mutate(years = year(date)) |> 
  mutate(months = as.Date(paste0(format(date, "%Y-%m"), "-01"), format = "%Y-%m-%d"))

# Calculate average temperatures by borough and year group

all_temp_borough = all_temp |> 
  mutate(date = as.Date(time, format = "%d/%m/%Y")) |> 
  mutate(data_years = ifelse(year(date) %in% 2016:2018, "2016-2018", "2019-2021")) |> 
  select(temperature_2m_max:data_years) |> 
  group_by(data_years, borough) |> 
  summarise(avg_temperature = mean(temperature_2m_mean, na.rm = TRUE))

```


```{r}

# Produce plot of monthly Mean temperature

all_temp_month = all_temp |> 
  group_by(months, borough) |> 
  summarise(avg_month = mean(temperature_2m_mean, na.rm = TRUE))

ggplot(all_temp_month, aes(x = months, y = avg_month, color = borough)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Monthly Mean Temperature (2016-2021) by Borough",
    x = "Month",
    y = "Average Temperature (Celsius)",
    color = "Borough"
  ) +
  theme_minimal()

```

**Figure 7. Monthly Mean Temperature across NYC Boroughs (2016-2021)**

Temperature analysis shows differences across New York City's boroughs between 2016 and 2021. While seasonal variations show consistent patterns across boroughs (peaks around 25°C and lows near 0°C), the slight but persistent temperature differences between boroughs suggest varying urban heat island effects. 


```{r}

# Mean temperature data

mean_temp_year = all_temp |> 
  group_by(years, borough) |> 
  summarize(
    high_temp = mean(temperature_2m_max, na.rm = TRUE),
    low_temp = mean(temperature_2m_min, na.rm = TRUE),
    mean_temp = mean(temperature_2m_mean, na.rm = TRUE)
  ) |> 
  arrange(years, borough) 

# Produce average temperature table with rounded values

mean_temp_year |> 
  select(years, borough, mean_temp) |> 
  mutate(mean_temp = round(mean_temp, 3)) |>
  pivot_wider(
    names_from = borough,
    values_from = mean_temp
  ) |>
  knitr::kable(col.names = c("Years", "Bronx", "Brooklyn", "Manhattan", "Queens", "Staten Island"))

```

**Table 7. Mean Temperature across NYC Boroughs (2016-2021)**

Brooklyn and Staten Island's slightly consistently higher average temperatures, compared to Manhattan's lower averages, may reflect differences in building density and greenspace coverage.

The observed warming trend between periods (0.2-0.3°C increase) aligns with broader climate change patterns but may also reflect the effects of localized urban developments. This warming pattern, combined with limited greenspace in asthma hotspot areas like the Bronx, suggests potential intersecting environmental health challenges.



#### Heat Vulnerability Index

While our exploratory analysis examined temperature patterns across NYC boroughs, our final modeling approach ultimately employed the Heat Vulnerability Index (HVI) rather than raw temperature measurements. This decision was driven by several key considerations. First, our exploratory analysis revealed that temperature patterns were very similar across all boroughs, with only slight variations in average temperatures (0.2-0.3°C differences). This uniformity in temperature measurements meant it would not be easy to explain the substantial geographic variations we observed in asthma outcomes. Second, HVI would be able to represent neighborhood-level variations in heat vulnerability that raw temperature data alone would unlikely show based on the data obtained.

Instead, we opted to use the Heat Vulnerability Index, which provides a more comprehensive measure of the impact of heat stress on different communities. The HVI incorporates not only environmental factors but also crucial socio-demographic characteristics that influence a community's resilience to heat stress. These include language vulnerability (relevant for NYC's diverse neighborhoods), socioeconomic vulnerability, environmental and urban vulnerability, and elderly isolation - factors that may indirectly affect childhood asthma outcomes through the social determinants of health, including housing quality, access to cooling infrastructure, and overall community resources.


# Correlations










# Regression Analysis
In our original project outline we considered modeling temperature, greenspace, and PM2.5 levels all in one linear regression model. After cleaning the data and conducting some exploratory analysis, we discovered that the average temperature across boroughs was not very different, thus indicating it may not be an ideal variable to predict asthma hospitalizations from. By searching the existing literature on this topic, we identified HVI as a better and more widely used indicator of risk for asthma emergencies. HVI better captures risk of poor health due to environmental factors, so we were interested to see if HVI alone is associated with asthma emergency visits and hospitalizations. 

Furthermore, we fit regression models for the time periods 2016-2018 and 2019-2021. We hypothesized that due to the improved environmental conditions as a result of the COVID-19 pandemic, environmental risk factors for pediatric asthma emergencies would decrease, thus resulting in lower pediatric asthma emergencies rates during time period 2019-2021. 

Using linear regression models, we observed the linear association between HVI and pediatric emergency department visit rates (per 10,000 children), by borough. Our models assign the reference group as the borough with the highest ED visit rate. 



```{r, include = FALSE}

# Load libraries

library(tidyverse)
library(broom)
library(patchwork)
library(lmtest)
library(car)

# Read full data

full_data2 = read_csv("data/NYC_total.csv")

# Data ED Visits (2016-2018)

full_data2_ed_1 = full_data2 |> 
  mutate(hvi = as.numeric(hvi)) |> 
  filter(indicator == "ed_visits_rate") |> 
  filter(data_years == "2016-2018")

## Datasets for Graphing (datasets 1 & 2):
## Changing HVI to numeric

# Data ED Visits (2019-2021)

full_data2_ed_2 = full_data2 |> 
  mutate(hvi = as.numeric(hvi)) |> 
  filter(indicator == "ed_visits_rate") |> 
  filter(data_years == "2019-2021")

# Data Hospitalizations (2016-2018)

full_data2_hosp_1 = full_data2 |> 
  mutate(hvi = as.numeric(hvi)) |> 
  filter(indicator == "hosp_rate") |>  
  filter(data_years == "2016-2018")

# Data Hospitalizations (2019-2021)

full_data2_hosp_2 = full_data2 |> 
  mutate(hvi = as.numeric(hvi)) |> 
  filter(indicator == "hosp_rate") |>  
  filter(data_years == "2019-2021")

## Datasets for Statistical Analysis (datasets 3 & 4):
## Keeping HVI as a factor variable


# Data ED Visits (2016-2018)

full_data2_ed_3 = full_data2 |> 
  filter(indicator == "ed_visits_rate") |>  # filtering only ed_visits
  filter(data_years == "2016-2018")

# Data ED Visits (2019-2021)

full_data2_ed_4 = full_data2 |> 
  filter(indicator == "ed_visits_rate") |>  # filtering only ed_visits
  filter(data_years == "2019-2021")

# Data Hospitalizations (2016-2018)

full_data2_hosp_3 = full_data2 |> 
  filter(indicator == "hosp_rate") |>  #filtering only hospitlization rate
  filter(data_years == "2016-2018")

# Data Hospitalizations (2019-2021)

full_data2_hosp_4 = full_data2 |> 
  filter(indicator == "hosp_rate") |>  #filtering only hospitlization rate
  filter(data_years == "2019-2021")

```

### Emergency Department Visits 

#### 2016-2018 period

```{r, include = FALSE}

# Fit linear regression model for ED visits (2016-2018)
# Examining relationship between visit rates and borough/HVI

fit = lm(zip_code_rate ~ borough + hvi, data = full_data2_ed_3)

# Format results table

results_table = tidy(fit) |>
  select(-statistic) |>
  knitr::kable(digit = 3)

# Display table

results_table

```


For the 2016-2018 time period, compared to the Bronx, Queens shows the largest reduction in ED visits (-169.36 visits, p < 0.001), followed by Brooklyn (-158.44 visits, p < 0.001) and Staten Island (-113.01 visits, p = 0.001). Manhattan's lower rate (-37.83 visits) was not statistically significant (p = 0.122).
Heat vulnerability shows a strong positive association with ED visits: for each one-unit increase in HVI score, ED visit rates increase by approximately 69.15 visits per 10,000 children (p < 0.001). 

This model indicates that both geographic location and heat vulnerability are significant predictors of pediatric asthma ED visits, with the Bronx experiencing substantially higher rates than most other boroughs. 

Earlier in our report we found that the Bronx has some of the highest PM2.5 levels and lowest greenspace acres. HVI factors in greenspace acres so it makes sense that places with less greenspace also have low HVI indexes. While PM2.5 levels are not factored into HVI index, we know that there are associations between greenspace and PM2.5 levels therefore it makes sense that places with high PM2.5 levels would have less greenspace, higher HVI indexes, and therefore more asthma emergencies.  

#### 2019-2021 period

```{r}

# Fit linear regression model for ED visits (2019-2021)
# Examining relationship between visit rates and borough/HVI

fit2 = lm(zip_code_rate ~ borough + hvi, data = full_data2_ed_4)

# Format results table

results_table2 = tidy(fit2) |>
  select(-statistic) |>
  knitr::kable(digit = 3)

# Display table

results_table2

```


For the 2019-2021 time period, Queens shows the largest reduction in ED visits compared to the Bronx (-88.61 visits, p < 0.001), closely followed by Brooklyn (-81.90 visits, p < 0.001). Staten Island shows fewer visits (-55.99, p = 0.001), while Manhattan's lower rate (-18.59 visits) remains not statistically significant (p = 0.140).

The HVI effect remains significant but notably smaller than the previous period: each one-unit increase in HVI score is associated with an increase of 35.18 visits per 10,000 children (p < 0.001), roughly half the effect seen in 2016-2018. This aligns with our hypothesis that improved environmental conditions during the COVID-19 pandemic likely decreased risk of asthma emergencies. Despite overall improvement in HVI and decreased asthma emergencies across NYC across these time periods, disparities remain by borough. 

### Hospitalizations

#### 2016-2018 period

```{r}

# Fit linear regression model for hospitalizations (2016-2018)

fit3 = lm(zip_code_rate ~ borough + hvi, data = full_data2_hosp_3)

# Format results table

results_table3 = tidy(fit3) |>
  select(-statistic) |>
  knitr::kable(digit = 3)

# Display table

results_table3

```


Here we conduct a similar analysis, however this time instead of hospital admission data we are looking at hospitalization data. During our exploratory analysis we found that rates of admission were less than half of hospitalizations across all boroughs, therefore we expect the linear regression slope to be smaller than that of adissions.The linear regression model examines pediatric asthma hospitalization rates per 10,000 children, with the Bronx as the reference borough.

For the 2016-2018 time period, Queens shows the largest reduction in hospitalizations compared to the Bronx (-30.62 visits, p < 0.001), followed by Brooklyn (-27.04 visits, p < 0.001) and Staten Island (-17.28, p = 0.004). Manhattan's lower rate (-8.17 visits) is not statistically significant (p = 0.069).

The HVI effect is significant but smaller when compared to ED visits: each one-unit increase in HVI score is associated with an increase of 10.14 hospitalizations per 10,000 children (p < 0.001). This is as expected based on our hypothesis.


#### 2019-2021 period

```{r}

# Fit linear regression model for hospitalizations (2019-2021)

fit4 = lm(zip_code_rate ~ borough + hvi, data = full_data2_hosp_4)
results_table4 = tidy(fit4) |>
  select(-statistic) |>
  knitr::kable(digit = 3)

# Format results table

results_table4 = tidy(fit4) |>
  select(-statistic) |>
  knitr::kable(digit = 3)

# Display table

results_table4

```

For the 2019-2021 time period, Queens shows the largest reduction in hospitalizations compared to the Bronx (-19.44 visits, p < 0.001), followed by Brooklyn (-17.65 visits, p < 0.001) and Staten Island (-13.55, p < 0.001). Unlike previous models, Manhattan's lower rate (-5.56 visits) is now statistically significant (p = 0.035).

The HVI effect remains significant but shows the smallest magnitude across all models: each one-unit increase in HVI score is associated with an increase of 5.23 hospitalizations per 10,000 children (p < 0.001).

### Summary of models

Examining all four models reveals a consistent pattern: Queens shows the lowest rates while the Bronx shows the highest, and higher HVI scores are consistently associated with higher rates of both ED visits and hospitalizations. 

### Model Diagnostics

```{r}

# Basic diagnostic tests for each model
# Function for basic diagnostics
basic_diagnostics = function(model, model_name) {
  # Shapiro-Wilk test for normality
  sw_test = shapiro.test(residuals(model))
  
  # Breusch-Pagan test for heteroscedasticity
  bp_test = bptest(model)
  
  # Create results
  results = data.frame(
    Model = model_name,
    Test = c("Shapiro-Wilk (Normality)", "Breusch-Pagan (Heteroscedasticity)"),
    Statistic = c(sw_test$statistic, bp_test$statistic),
    P_Value = c(sw_test$p.value, bp_test$p.value)
  )
  
  return(results)
}

# Run diagnostics for all models
all_diagnostics = rbind(
  basic_diagnostics(fit, "ED Visits 2016-2018"),
  basic_diagnostics(fit2, "ED Visits 2019-2021"),
  basic_diagnostics(fit3, "Hospitalizations 2016-2018"),
  basic_diagnostics(fit4, "Hospitalizations 2019-2021")
)

# Display results
knitr::kable(all_diagnostics, digits = 4)

```

Our diagnostic testing examined two key model assumptions using Shapiro-Wilk tests for normality and Breusch-Pagan tests for homoscedasticity. Results indicate statistical significance (p < 0.05) for violations of both assumptions. However, with moderate to large sample sizes (ED visits: n=171 for 2016-2018, n=168 for 2019-2021; Hospitalizations: n=155 for 2016-2018, n=140 for 2019-2021), our models maintain reasonable robustness to these violations. The Shapiro-Wilk statistics (all W > 0.90) suggest only mild deviations from normality. The Breusch-Pagan tests indicate the presence of heteroscedasticity, but this primarily affects efficiency rather than consistency of our estimates. Therefore, while not perfect, our models provide reliable insights into the relationships between borough characteristics, heat vulnerability, and health outcomes.

```{r}

# Basic diagnostic plots for all models

par(mfrow=c(2,2))
plot(fit, main="ED Visits 2016-2018")
par(mfrow=c(2,2))
plot(fit2, main="ED Visits 2019-2021")
par(mfrow=c(2,2))
plot(fit3, main="Hospitalizations 2016-2018")
par(mfrow=c(2,2))
plot(fit4, main="Hospitalizations 2019-2021")

```

The diagnostic plots show important patterns across our models:

* QQ Plots show moderate deviations from normality, particularly in the tails. This is most observable in the hospitalizations 2016-2018 model, where observations 68 and 71 deviate notably from the expected normal line. However, the overall pattern seems to suggest only mild violations of normality, for both ED visits and hospitalizations models.

* Residuals vs Fitted plots indicate relatively consistent spread around zero, though with some heteroscedasticity at higher fitted values, especially in the ED visits models. The hospitalization models show a more consistent pattern, which would indicate a better fit for these outcomes.

* Scale-Location plots confirm the presence of mild heteroscedasticity, with slightly increasing spread in the standardized residuals as fitted values increase. This pattern is more evident in the ED visits models than in the hospitalization models.

* Residuals vs Leverage plots show a few potentially influential observations (e.g., observations 75 and 76 in ED visits 2016-2018; 68 and 71 in hospitalizations 2016-2018), but none appear to exceed Cook's distance thresholds (dotted lines). This indicates these points do not greatly impact our model estimates.

While these diagnostics do appear to suggest some deviation from model assumptions, the violations are not severe enough to invalidate our main findings, particularly given our moderately large sample sizes.

### Borough-Level HVI Analysis

```{r}

# Calculate average HVI scores for each borough
# This helps understand overall heat vulnerability patterns across boroughs

daa = full_data2 |> 
  mutate(hvi = as.numeric(hvi)) |>
  group_by(borough) |> 
  summarise(hvi_mean = mean(hvi))

# Produce table

knitr::kable(daa)

```

The mean Heat Vulnerability Index varies considerably across NYC boroughs, with the Bronx showing the highest average (4.07), followed by Brooklyn (3.65), Queens (3.27), Manhattan (2.42), and Staten Island (2.07). This suggests that heat vulnerability is not evenly distributed across the city, with some boroughs experiencing systematically higher heat vulnerability than others. The notable variation in HVI means across boroughs indicates that geographic and demographic factors play an important role in heat vulnerability distribution in NYC.

```{r}

# Plot for mean HVI scores by borough

borough_plot = ggplot(daa, aes(x = reorder(borough, -hvi_mean), y = hvi_mean)) +
  geom_bar(stat = "identity", fill = "steelblue", alpha = 0.8) +
  geom_text(aes(label = round(hvi_mean, 2)), 
            vjust = -0.5, 
            size = 3.5) +
  labs(title = "Mean Heat Vulnerability Index (HVI) by Borough",
       x = "Borough",
       y = "Mean HVI Score") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5)) +
  ylim(0, max(daa$hvi_mean) * 1.1)  # Add some space above bars for labels

# Display the plot

borough_plot

```

The above plot provides a visual representation of these HVI disparities, with a noticeable difference between the Bronx and Staten Island - a gap of 2 points on the HVI scale.

### Visualization of Relationships

```{r, fig.height=10, fig.width=12}

# Create visualization plots showing relationship between HVI scores and health outcomes
# Four plots examine ED visits and hospitalizations across both time periods

# Create plots

plot1 = ggplot(full_data2_ed_1, aes(x = hvi, y = zip_code_rate)) +
  geom_point(color = "blue", alpha = 0.6) +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  labs(title = "ED Visit rate per HVI score (2016-2018)", 
       x = "HVI", y = "ED Visit Rate") +
  theme_minimal()

plot2 = ggplot(full_data2_ed_2, aes(x = hvi, y = zip_code_rate)) +
  geom_point(color = "blue", alpha = 0.6) +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  labs(title = "ED Visit rate per HVI score (2019-2021)", 
       x = "HVI", y = "ED Visit Rate") +
  theme_minimal()

plot3 = ggplot(full_data2_hosp_1, aes(x = hvi, y = zip_code_rate)) +
  geom_point(color = "blue", alpha = 0.6) +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  labs(title = "Hospitalization rate per HVI score (2016-2018)", 
       x = "HVI", y = "Hospitalization Rate") +
  theme_minimal()

plot4 = ggplot(full_data2_hosp_2, aes(x = hvi, y = zip_code_rate)) +
  geom_point(color = "blue", alpha = 0.6) +
  geom_smooth(method = "lm", color = "red", se = TRUE) +
  labs(title = "Hospitalization rate per HVI score (2019-2021)", 
       x = "HVI", y = "Hospitalization Rate") +
  theme_minimal()

# Combine plots with adjusted height and width
(plot1 + plot2) / (plot3 + plot4) +
  patchwork::plot_layout(heights = c(3, 3), widths = c(3, 3))

```

The scatter plots show consistent positive relationships between Heat Vulnerability Index and both pediatric asthma health outcomes across time periods. ED visit rates show a stronger association with HVI than hospitalization rates, as observed in steeper trend lines. The relationship appears more pronounced in the 2016-2018 period, with ED visits ranging from 0 to approximately 700 per 10,000 across HVI scores, compared to 0-350 in 2019-2021. 

While the overall patterns persist in 2019-2021, the rates are lower, particularly for ED visits. The considerable vertical spread in the data points at each HVI level suggests that other factors beyond heat vulnerability influence pediatric asthma health outcomes.







# References

Corburn, J., Osleeb, J., & Porter, M. (2006). Urban asthma and the neighbourhood environment in New York City. Health & place, 12(2), 167-179.

Heaviside, C., Macintyre, H., & Vardoulakis, S. (2017). The urban heat island: implications for health in a changing environment. Current environmental health reports, 4, 296-305.

Sheffield, P. E., Herrera, M. T., Kinnee, E. J., & Clougherty, J. E. (2018). Not so little differences: variation in hot weather risk to young children in New York City. Public health, 161, 119–126. https://doi.org/10.1016/j.puhe.2018.06.004


